<!-- ユーティリティ関数の読み込み -->
<script>console.log('🔧 Constants読み込み開始');</script>
<?!= include('utils\\constants'); ?>
<script>console.log('🔧 Constants読み込み完了');</script>

<script>console.log('🔧 DataLoader読み込み開始');</script>
<?!= include('utils\\dataLoader'); ?>
<script>console.log('🔧 DataLoader読み込み完了');</script>

<!-- JavaScriptコンポーネントの読み込み -->
<script>console.log('🔧 Auth読み込み開始');</script>
<?!= include('components\\auth'); ?>
<script>console.log('🔧 Auth読み込み完了');</script>

<script>console.log('🔧 StudentInfo読み込み開始');</script>
<?!= include('components\\studentInfo'); ?>
<script>console.log('🔧 StudentInfo読み込み完了');</script>

<script>console.log('🔧 SubjectList読み込み開始');</script>
<?!= include('components\\subjectList'); ?>
<script>console.log('🔧 SubjectList読み込み完了');</script>

<script>console.log('🔧 Registration読み込み開始');</script>
<?!= include('components\\registration'); ?>
<script>console.log('🔧 Registration読み込み完了');</script>

<script>console.log('🔧 Summary読み込み開始');</script>
<?!= include('components\\summary'); ?>
<script>console.log('🔧 Summary読み込み完了');</script>

<script>console.log('🔧 TabNavigation読み込み開始');</script>
<?!= include('components\\tabNavigation'); ?>
<script>console.log('🔧 TabNavigation読み込み完了');</script>

<!-- メインアプリケーション -->
<?!= include('main'); ?>

<script>
    // グローバル変数（互換性維持のため）
    let studentData = {};
    let subjectData = [];
    let registeredSubjects = [];

    // 旧関数名との互換性維持（段階的移行のため）
    function loadStudentInfo() {
        App.loadStudentData();
    }

    function loadSubjects() {
        App.loadSubjectData();
    }

    function loadRegistrations() {
        App.loadRegistrationData();
    }

    function displayAvailableSubjects() {
        SubjectList.displayAvailable();
    }

    function displayRegisteredSubjects() {
        SubjectList.displayRegistered();
    }

    function updateSummary() {
        Summary.update();
    }

    function registerSubject(subjectId) {
        Registration.register(subjectId);
    }

    function unregisterSubject(subjectId) {
        Registration.unregister(subjectId);
    }

    // 手動リフレッシュ用のグローバル関数
    function refreshData() {
        App.refresh();
    }

    // タブ切り替え用のグローバル関数（HTMLから呼び出し用）
    function showTab(tabName) {
        // DOMContentLoadedを待ってからTabNavigationを呼び出す
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                showTab(tabName);
            });
            return;
        }

        if (window.TabNavigation && TabNavigation.showTab) {
            TabNavigation.showTab(tabName);
        } else {
            console.error('TabNavigationコンポーネントが読み込まれていません');
            console.log('利用可能なオブジェクト:', Object.keys(window).filter(k => k.includes('Tab')));
        }
    }

    // DOM読み込み完了後に実行される初期化
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🔧 DOMContentLoaded: すべてのスクリプトが読み込まれました');

        // 各コンポーネントの読み込み状況確認
        console.log('📦 コンポーネント読み込み状況:');
        console.log('  - Auth:', !!window.Auth);
        console.log('  - App:', !!window.App);
        console.log('  - DataLoader:', !!window.DataLoader);
        console.log('  - TabNavigation:', !!window.TabNavigation);
        console.log('  - StudentInfo:', !!window.StudentInfo);
        console.log('  - Registration:', !!window.Registration);
        console.log('  - Summary:', !!window.Summary);
        console.log('  - SubjectList:', !!window.SubjectList);

        // TabNavigationが利用可能かチェック
        if (window.TabNavigation) {
            console.log('TabNavigation methods:', Object.keys(TabNavigation));
        }

        // タブボタンにイベントリスナーを追加
        const tabButtons = document.querySelectorAll('.tab-button');
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');
                console.log('タブクリック:', tabName);
                if (tabName) {
                    showTab(tabName);
                }
            });
        });
    });
</script>