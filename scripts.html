<!-- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®èª­ã¿è¾¼ã¿ -->
<script>console.log('ğŸ”§ Constantsèª­ã¿è¾¼ã¿é–‹å§‹');</script>

<!-- ãƒ†ã‚¹ãƒˆç”¨: Constantsã‚’ç›´æ¥åŸ‹ã‚è¾¼ã¿ -->
<script>
    // å®šæ•°ãƒ»è¨­å®šå€¤ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    const Constants = {
        // å­¦ç”Ÿé–¢é€£ã®å®šæ•°
        STUDENT: {
            DEFAULT_ID: 'S2023001',
            GRADES: {
                FIRST: '1',
                SECOND: '2',
                THIRD: '3'
            }
        },
        // ç§‘ç›®é–¢é€£ã®å®šæ•°
        SUBJECT: {
            TYPES: {
                REQUIRED: 'å¿…ä¿®',
                ELECTIVE: 'é¸æŠ'
            }
        },
        // UIé–¢é€£ã®å®šæ•°
        UI: {
            ERROR_MESSAGES: {
                STUDENT_NOT_FOUND: 'å­¦ç”Ÿæƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚',
                AUTH_FAILED: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚',
                EMAIL_NOT_REGISTERED: 'ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å±¥ä¿®æƒ…å ±ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚',
                GENERAL_ERROR: 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
            },
            CONFIRM_MESSAGES: {
                REGISTER: (subjectName) => `${subjectName}ã‚’å±¥ä¿®ç™»éŒ²ã—ã¾ã™ã‹ï¼Ÿ`,
                UNREGISTER: (subjectName) => `${subjectName}ã®å±¥ä¿®ã‚’å–ã‚Šæ¶ˆã—ã¾ã™ã‹ï¼Ÿ`
            }
        },
        // DOMè¦ç´ ã®ID
        ELEMENTS: {
            STUDENT_ID: 'student-id',
            STUDENT_NAME: 'student-name',
            STUDENT_GRADE: 'student-grade',
            STUDENT_CLASS: 'student-class'
        }
    };

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«ç™»éŒ²
    window.Constants = Constants;
    console.log('âœ… Constants (ç›´æ¥åŸ‹ã‚è¾¼ã¿) ç™»éŒ²å®Œäº†');
</script>

<script>console.log('ğŸ”§ Constantsèª­ã¿è¾¼ã¿å®Œäº†');</script>

<script>console.log('ğŸ”§ DataLoaderèª­ã¿è¾¼ã¿é–‹å§‹');</script>
<?!= include('utils\\dataLoader'); ?>
<script>console.log('ğŸ”§ DataLoaderèª­ã¿è¾¼ã¿å®Œäº†');</script>

<!-- JavaScriptã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®èª­ã¿è¾¼ã¿ -->
<script>console.log('ğŸ”§ Authèª­ã¿è¾¼ã¿é–‹å§‹');</script>

<!-- ãƒ†ã‚¹ãƒˆç”¨: Authã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æœ€å°æ§‹æˆã§ç›´æ¥åŸ‹ã‚è¾¼ã¿ -->
<script>
    console.log('ğŸ”§ Authç›´æ¥åŸ‹ã‚è¾¼ã¿é–‹å§‹');

    // ç°¡æ˜“Authã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    const Auth = {
        state: {
            isAuthenticated: false,
            currentUser: null,
            studentData: null,
            isLoading: false
        },

        init: function() {
            console.log('ğŸ” Auth.init() å®Ÿè¡Œé–‹å§‹');
            this.authenticate();
        },

        authenticate: function() {
            console.log('ğŸ” èªè¨¼å‡¦ç†é–‹å§‹ (ãƒ†ã‚¹ãƒˆç‰ˆ)');
            // ãƒ†ã‚¹ãƒˆç”¨: å›ºå®šã®èªè¨¼æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
            setTimeout(() => {
                console.log('âœ… èªè¨¼æˆåŠŸ (ãƒ†ã‚¹ãƒˆç‰ˆ)');
                this.state.isAuthenticated = true;
                this.state.studentData = {
                    id: 'TEST001',
                    name: 'ãƒ†ã‚¹ãƒˆå­¦ç”Ÿ',
                    email: 'test@example.com',
                    grade: '2',
                    class: 'A'
                };
                this.notifyAuthStateChanged();
            }, 1000);
        },

        notifyAuthStateChanged: function() {
            console.log('ğŸ“¢ èªè¨¼çŠ¶æ…‹å¤‰æ›´é€šçŸ¥ (ãƒ†ã‚¹ãƒˆç‰ˆ)');
            if (this.onAuthStateChanged) {
                this.onAuthStateChanged({
                    isAuthenticated: this.state.isAuthenticated,
                    studentData: this.state.studentData,
                    currentUser: { email: 'test@example.com' }
                });
            }
        },

        onAuthStateChanged: null
    };

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«ç™»éŒ²
    window.Auth = Auth;
    console.log('âœ… Auth (ãƒ†ã‚¹ãƒˆç‰ˆç›´æ¥åŸ‹ã‚è¾¼ã¿) ç™»éŒ²å®Œäº†');
</script>

<script>console.log('ğŸ”§ Authèª­ã¿è¾¼ã¿å®Œäº†');</script>

<script>console.log('ğŸ”§ StudentInfoèª­ã¿è¾¼ã¿é–‹å§‹');</script>

<!-- ãƒ†ã‚¹ãƒˆç”¨: StudentInfoã‚’æœ€å°æ§‹æˆã§ç›´æ¥åŸ‹ã‚è¾¼ã¿ -->
<script>
    const StudentInfo = {
        display: function(student) {
            console.log('ğŸ“‹ å­¦ç”Ÿæƒ…å ±è¡¨ç¤º:', student);
            if (student) {
                const setElement = (id, text) => {
                    const elem = document.getElementById(id);
                    if (elem) elem.textContent = text;
                };

                setElement('student-id', student.id || '');
                setElement('student-name', student.name || '');
                setElement('student-grade', (student.grade || '') + 'å¹´ç”Ÿ');
                setElement('student-class', (student.class || '') + 'ã‚¯ãƒ©ã‚¹');
            }
        }
    };

    window.StudentInfo = StudentInfo;
    console.log('âœ… StudentInfo (ãƒ†ã‚¹ãƒˆç‰ˆç›´æ¥åŸ‹ã‚è¾¼ã¿) ç™»éŒ²å®Œäº†');
</script>

<script>console.log('ğŸ”§ StudentInfoèª­ã¿è¾¼ã¿å®Œäº†');</script>

<script>console.log('ğŸ”§ SubjectListèª­ã¿è¾¼ã¿é–‹å§‹');</script>
<?!= include('components\\subjectList'); ?>
<script>console.log('ğŸ”§ SubjectListèª­ã¿è¾¼ã¿å®Œäº†');</script>

<script>console.log('ğŸ”§ Registrationèª­ã¿è¾¼ã¿é–‹å§‹');</script>
<?!= include('components\\registration'); ?>
<script>console.log('ğŸ”§ Registrationèª­ã¿è¾¼ã¿å®Œäº†');</script>

<script>console.log('ğŸ”§ Summaryèª­ã¿è¾¼ã¿é–‹å§‹');</script>
<?!= include('components\\summary'); ?>
<script>console.log('ğŸ”§ Summaryèª­ã¿è¾¼ã¿å®Œäº†');</script>

<script>console.log('ğŸ”§ TabNavigationèª­ã¿è¾¼ã¿é–‹å§‹');</script>

<!-- ãƒ†ã‚¹ãƒˆç”¨: TabNavigationã‚’ç›´æ¥åŸ‹ã‚è¾¼ã¿ -->
<script>
    const TabNavigation = {
        showTab: function(tabName) {
            console.log('ğŸ”„ ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ:', tabName);

            // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’è¡¨ç¤º
            const targetTab = document.getElementById(tabName + '-tab');
            if (targetTab) {
                targetTab.classList.add('active');
            }

            // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ï¼ˆevent.targetãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆï¼‰
            if (event && event.target) {
                event.target.classList.add('active');
            }
        },

        init: function() {
            console.log('ğŸ”§ TabNavigationåˆæœŸåŒ–');

            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ€åˆã®ã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
            const firstTab = document.querySelector('.tab-button');
            if (firstTab) {
                firstTab.classList.add('active');
                console.log('âœ… æœ€åˆã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–');
            }

            const firstTabContent = document.querySelector('.tab-content');
            if (firstTabContent) {
                firstTabContent.classList.add('active');
                console.log('âœ… æœ€åˆã®ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–');
            }
        }
    };

    window.TabNavigation = TabNavigation;
    console.log('âœ… TabNavigation (ãƒ†ã‚¹ãƒˆç‰ˆç›´æ¥åŸ‹ã‚è¾¼ã¿) ç™»éŒ²å®Œäº†');
</script>

<script>console.log('ğŸ”§ TabNavigationèª­ã¿è¾¼ã¿å®Œäº†');</script>

<!-- ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ†ã‚¹ãƒˆç”¨ç›´æ¥åŸ‹ã‚è¾¼ã¿ï¼‰ -->
<script>console.log('ğŸ”§ Main Appèª­ã¿è¾¼ã¿é–‹å§‹');</script>

<script>
    // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ï¼ˆãƒ†ã‚¹ãƒˆç‰ˆï¼‰
    const App = {
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ç®¡ç†
        state: {
            studentData: {},
            subjectData: [],
            registeredSubjects: [],
            isLoading: {
                student: false,
                subjects: false,
                registrations: false
            },
            currentTab: 'available'
        },

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
        init: function () {
            console.log('ğŸš€ å±¥ä¿®ç™»éŒ²ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹...');
            console.log('ğŸ“‹ ç¾åœ¨ã®èª­ã¿è¾¼ã¿çŠ¶æ…‹:', document.readyState);

            // DOMèª­ã¿è¾¼ã¿å®Œäº†å¾Œã®å‡¦ç†
            document.addEventListener('DOMContentLoaded', () => {
                console.log('âœ… DOMContentLoaded: AppåˆæœŸåŒ–é–‹å§‹');
                this.setupEventListeners();
                this.initializeAuth();
                if (window.TabNavigation) {
                    TabNavigation.init();
                }
            });

            // æ—¢ã«DOMãŒèª­ã¿è¾¼ã¿æ¸ˆã¿ã®å ´åˆ
            if (document.readyState !== 'loading') {
                console.log('ğŸ”„ DOMã¯æ—¢ã«èª­ã¿è¾¼ã¿æ¸ˆã¿ã€å³åº§ã«åˆæœŸåŒ–å®Ÿè¡Œ');
                this.setupEventListeners();
                this.initializeAuth();
                if (window.TabNavigation) {
                    TabNavigation.init();
                }
            }
        },

        // èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–
        initializeAuth: function () {
            console.log('ğŸ” èªè¨¼ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹');
            console.log('ğŸ” Auth ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç¢ºèª:', !!window.Auth);

            if (!window.Auth) {
                console.error('âŒ Authã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ï¼');
                alert('ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼: èªè¨¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return;
            }

            // èªè¨¼çŠ¶æ…‹å¤‰æ›´æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š
            Auth.onAuthStateChanged = (authState) => {
                console.log('ğŸ“¢ èªè¨¼çŠ¶æ…‹å¤‰æ›´é€šçŸ¥:', authState);
                if (authState.isAuthenticated && authState.studentData) {
                    console.log('âœ… èªè¨¼æˆåŠŸ - ã‚¢ãƒ—ãƒªé–‹å§‹');
                    // èªè¨¼æˆåŠŸæ™‚ï¼šå­¦ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¦ã‚¢ãƒ—ãƒªã‚’é–‹å§‹
                    this.setState('studentData', authState.studentData);
                    this.setState('currentUserEmail', authState.currentUser.email);
                    this.loadInitialData();
                } else {
                    console.log('âŒ èªè¨¼å¤±æ•—ã¾ãŸã¯ãƒ‡ãƒ¼ã‚¿ä¸è¶³');
                }
            };

            // èªè¨¼é–‹å§‹
            console.log('ğŸš€ Auth.init() å‘¼ã³å‡ºã—');
            Auth.init();
        },

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        setupEventListeners: function () {
            // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®è­¦å‘Šï¼ˆæœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚‹å ´åˆï¼‰
            window.addEventListener('beforeunload', (e) => {
                if (this.hasUnsavedChanges()) {
                    e.preventDefault();
                    e.returnValue = '';
                }
            });

            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
            document.addEventListener('keydown', (e) => {
                // Ctrl+R ã§æ‰‹å‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    this.refresh();
                }
            });
        },

        // åˆæœŸãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        loadInitialData: function () {
            console.log('ğŸ“Š åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹');
            this.state.isLoading.student = true;
            this.state.isLoading.subjects = true;
            this.state.isLoading.registrations = true;

            // ä¸¦åˆ—ã§ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
            Promise.all([
                this.loadStudentData(),
                this.loadSubjectData(),
                this.loadRegistrationData()
            ]).then(() => {
                console.log('âœ… å…¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿å®Œäº†');
                this.onDataLoadComplete();
            }).catch((error) => {
                console.error('âŒ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                this.handleGlobalError(error);
            });
        },

        // å­¦ç”Ÿãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ï¼ˆèªè¨¼å¾Œï¼‰
        loadStudentData: function () {
            return new Promise((resolve, reject) => {
                // èªè¨¼æ¸ˆã¿ã®å­¦ç”Ÿãƒ‡ãƒ¼ã‚¿ãŒæ—¢ã«ã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                if (this.state.studentData && this.state.studentData.id) {
                    console.log('ğŸ‘¤ å­¦ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºä¸­:', this.state.studentData);
                    if (window.StudentInfo) {
                        StudentInfo.display(this.state.studentData);
                    }
                    this.state.isLoading.student = false;
                    resolve(this.state.studentData);
                } else {
                    // èªè¨¼ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼
                    console.error('âŒ å­¦ç”Ÿæƒ…å ±ãŒèªè¨¼ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    this.state.isLoading.student = false;
                    reject(new Error('å­¦ç”Ÿæƒ…å ±ãŒèªè¨¼ã•ã‚Œã¦ã„ã¾ã›ã‚“'));
                }
            });
        },

        // ç§‘ç›®ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        loadSubjectData: function () {
            return new Promise((resolve, reject) => {
                // å­¦ç”Ÿãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                if (!this.state.studentData || !this.state.studentData.id) {
                    console.error('âŒ å­¦ç”Ÿãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                    this.state.isLoading.subjects = false;
                    reject(new Error('å­¦ç”Ÿãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“'));
                    return;
                }

                console.log('ğŸ“š ç§‘ç›®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...', {
                    grade: this.state.studentData.grade,
                    studentId: this.state.studentData.id
                });

                if (window.DataLoader) {
                    DataLoader.getAvailableSubjects(
                        this.state.studentData.grade || '2',
                        this.state.studentData.id,
                        (subjects) => {
                            console.log('âœ… ç§‘ç›®ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ:', subjects);
                            const formattedSubjects = subjects.map(subject => ({
                                id: subject.id,
                                name: subject.name,
                                credits: subject.credits,
                                grade: subject.targetGrade,
                                type: subject.type,
                                condition: subject.condition,
                                available: true
                            }));

                            this.setState('subjectData', formattedSubjects);
                            this.state.isLoading.subjects = false;
                            resolve(formattedSubjects);
                        },
                        (error) => {
                            console.error('âŒ ç§‘ç›®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                            this.state.isLoading.subjects = false;
                            reject(error);
                        }
                    );
                } else {
                    console.error('âŒ DataLoaderãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                    this.state.isLoading.subjects = false;
                    reject(new Error('DataLoaderãŒåˆ©ç”¨ã§ãã¾ã›ã‚“'));
                }
            });
        },

        // å±¥ä¿®ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        loadRegistrationData: function () {
            return new Promise((resolve, reject) => {
                const studentId = this.state.studentData ? this.state.studentData.id : null;
                if (!studentId) {
                    console.error('âŒ å­¦ç”Ÿæƒ…å ±ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                    this.state.isLoading.registrations = false;
                    reject(new Error('å­¦ç”Ÿæƒ…å ±ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“'));
                    return;
                }

                console.log('ğŸ“ å±¥ä¿®ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...', { studentId });

                if (window.DataLoader) {
                    DataLoader.getStudentRegistrations(
                        studentId,
                        (registrations) => {
                            console.log('âœ… å±¥ä¿®ç™»éŒ²ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ:', registrations);
                            const registeredSubjects = registrations.map(reg => ({
                                id: `REG_${reg.subjectName}`,
                                name: reg.subjectName,
                                status: reg.status,
                                credits: this.getSubjectCredits(reg.subjectName),
                                type: this.getSubjectType(reg.subjectName)
                            }));

                            this.setState('registeredSubjects', registeredSubjects);
                            this.state.isLoading.registrations = false;
                            resolve(registeredSubjects);
                        },
                        (error) => {
                            console.error('âŒ å±¥ä¿®ç™»éŒ²ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                            this.state.isLoading.registrations = false;
                            reject(error);
                        }
                    );
                } else {
                    console.error('âŒ DataLoaderãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                    this.state.isLoading.registrations = false;
                    reject(new Error('DataLoaderãŒåˆ©ç”¨ã§ãã¾ã›ã‚“'));
                }
            });
        },

        // ç§‘ç›®åã‹ã‚‰å˜ä½æ•°ã‚’æ¨å®šã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        getSubjectCredits: function (subjectName) {
            if (subjectName.includes('ä½“è‚²')) return 1;
            if (subjectName.includes('ä¿å¥')) return 1;
            if (subjectName.includes('ç¾è¡“')) return 2;
            if (subjectName.includes('ç·åˆ')) return 1;
            return 2;
        },

        // ç§‘ç›®åã‹ã‚‰ç¨®åˆ¥ã‚’æ¨å®šã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        getSubjectType: function (subjectName) {
            const requiredSubjects = ['ç¾ä»£ã®å›½èª', 'æ­´å²ç·åˆ', 'åœ°ç†ç·åˆ', 'æ•°å­¦â… ', 'ç§‘å­¦ã¨äººé–“ç”Ÿæ´»', 'ä½“è‚²â… ', 'è‹±èªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³â… ', 'æƒ…å ±â… '];
            if (requiredSubjects.some(req => subjectName.includes(req.replace(/ï½ºï¾ï½­ï¾†ï½¹ï½°ï½¼ï½®ï¾/g, 'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³')))) {
                return 'å¿…ä¿®';
            }
            return 'é¸æŠ';
        },

        // å…¨ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã®å‡¦ç†
        onDataLoadComplete: function () {
            console.log('ğŸ‰ å…¨ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº† - UIæ›´æ–°é–‹å§‹');

            // å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¡¨ç¤ºã‚’æ›´æ–°
            if (window.SubjectList) {
                SubjectList.displayAvailable();
                SubjectList.displayRegistered();
            }
            if (window.Summary) {
                Summary.update();
            }
        },

        // çŠ¶æ…‹ã®æ›´æ–°ï¼ˆReactã®setStateã®ã‚ˆã†ãªæ©Ÿèƒ½ï¼‰
        setState: function (key, value) {
            const oldValue = this.state[key];
            this.state[key] = value;

            console.log(`ğŸ“Š State changed: ${key}`, { old: oldValue, new: value });

            // çŠ¶æ…‹å¤‰æ›´ã«å¿œã˜ãŸå‡¦ç†
            this.onStateChange(key, value, oldValue);
        },

        // çŠ¶æ…‹å¤‰æ›´æ™‚ã®å‡¦ç†
        onStateChange: function (key, newValue, oldValue) {
            switch (key) {
                case 'registeredSubjects':
                    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚‚æ›´æ–°ï¼ˆäº’æ›æ€§ç¶­æŒï¼‰
                    if (typeof registeredSubjects !== 'undefined') {
                        registeredSubjects = newValue;
                    }
                    break;
                case 'subjectData':
                    if (typeof subjectData !== 'undefined') {
                        subjectData = newValue;
                    }
                    break;
                case 'studentData':
                    if (typeof studentData !== 'undefined') {
                        studentData = newValue;
                    }
                    break;
            }
        },

        // ãƒ‡ãƒ¼ã‚¿ã®æ‰‹å‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
        refresh: function () {
            console.log('ğŸ”„ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ä¸­...');
            if (window.Auth && Auth.state && Auth.state.isAuthenticated) {
                this.loadInitialData();
            } else if (window.Auth) {
                Auth.init();
            }
        },

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
        handleGlobalError: function (error) {
            console.error('âŒ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼:', error);

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            this.state.isLoading.student = false;
            this.state.isLoading.subjects = false;
            this.state.isLoading.registrations = false;

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ†ã‹ã‚Šã‚„ã™ã„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            const errorMessage = this.getErrorMessage(error);
            alert(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${errorMessage}`);
        },

        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å–å¾—
        getErrorMessage: function (error) {
            if (error.message) {
                return error.message;
            }
            return 'ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
        },

        // æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        hasUnsavedChanges: function () {
            return false;
        }
    };

    // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
    App.init();

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
    window.App = App;
    console.log('âœ… App (ãƒ†ã‚¹ãƒˆç‰ˆç›´æ¥åŸ‹ã‚è¾¼ã¿) ç™»éŒ²å®Œäº†');
</script>

<script>console.log('ğŸ”§ Main Appèª­ã¿è¾¼ã¿å®Œäº†');</script>

<script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ï¼ˆäº’æ›æ€§ç¶­æŒã®ãŸã‚ï¼‰
    let studentData = {};
    let subjectData = [];
    let registeredSubjects = [];

    // æ—§é–¢æ•°åã¨ã®äº’æ›æ€§ç¶­æŒï¼ˆæ®µéšçš„ç§»è¡Œã®ãŸã‚ï¼‰
    function loadStudentInfo() {
        App.loadStudentData();
    }

    function loadSubjects() {
        App.loadSubjectData();
    }

    function loadRegistrations() {
        App.loadRegistrationData();
    }

    function displayAvailableSubjects() {
        SubjectList.displayAvailable();
    }

    function displayRegisteredSubjects() {
        SubjectList.displayRegistered();
    }

    function updateSummary() {
        Summary.update();
    }

    function registerSubject(subjectId) {
        Registration.register(subjectId);
    }

    function unregisterSubject(subjectId) {
        Registration.unregister(subjectId);
    }

    // æ‰‹å‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ç”¨ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
    function refreshData() {
        App.refresh();
    }

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆç”¨ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆHTMLã‹ã‚‰å‘¼ã³å‡ºã—ç”¨ï¼‰
    function showTab(tabName) {
        // DOMContentLoadedã‚’å¾…ã£ã¦ã‹ã‚‰TabNavigationã‚’å‘¼ã³å‡ºã™
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                showTab(tabName);
            });
            return;
        }

        if (window.TabNavigation && TabNavigation.showTab) {
            TabNavigation.showTab(tabName);
        } else {
            console.error('TabNavigationã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
            console.log('åˆ©ç”¨å¯èƒ½ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ:', Object.keys(window).filter(k => k.includes('Tab')));
        }
    }

    // DOMèª­ã¿è¾¼ã¿å®Œäº†å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ğŸ”§ DOMContentLoaded: ã™ã¹ã¦ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');

        // å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®èª­ã¿è¾¼ã¿çŠ¶æ³ç¢ºèª
        console.log('ğŸ“¦ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆèª­ã¿è¾¼ã¿çŠ¶æ³:');
        console.log('  - Auth:', !!window.Auth);
        console.log('  - App:', !!window.App);
        console.log('  - DataLoader:', !!window.DataLoader);
        console.log('  - TabNavigation:', !!window.TabNavigation);
        console.log('  - StudentInfo:', !!window.StudentInfo);
        console.log('  - Registration:', !!window.Registration);
        console.log('  - Summary:', !!window.Summary);
        console.log('  - SubjectList:', !!window.SubjectList);

        // TabNavigationãŒåˆ©ç”¨å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
        if (window.TabNavigation) {
            console.log('TabNavigation methods:', Object.keys(TabNavigation));
        }

        // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
        const tabButtons = document.querySelectorAll('.tab-button');
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');
                console.log('ã‚¿ãƒ–ã‚¯ãƒªãƒƒã‚¯:', tabName);
                if (tabName) {
                    showTab(tabName);
                }
            });
        });
    });
</script>