<script>
    // 科目一覧コンポーネント
    const SubjectList = {
        // 科目情報の読み込み
        load: function() {
            const studentId = 'S2023001'; // 仮の学生ID

            google.script.run
                .withSuccessHandler(function(subjects) {
                    subjectData = subjects.map(subject => ({
                        id: subject.id,
                        name: subject.name,
                        credits: subject.credits,
                        grade: subject.targetGrade,
                        type: subject.type,
                        condition: subject.condition,
                        available: true
                    }));

                    SubjectList.displayAvailable();
                    document.getElementById('loading-available').style.display = 'none';
                    document.getElementById('available-subjects').style.display = 'grid';
                })
                .withFailureHandler(function(error) {
                    document.getElementById('loading-available').innerHTML =
                        '<div class="error">エラー: ' + error.message + '</div>';
                })
                .getAvailableSubjects(studentData.grade || '2', studentId);
        },

        // 履修可能科目の表示
        displayAvailable: function() {
            const container = document.getElementById('available-subjects');
            container.innerHTML = '';

            subjectData.forEach(subject => {
                const isRegistered = registeredSubjects.some(reg => reg.id === subject.id);

                const subjectCard = document.createElement('div');
                subjectCard.className = `subject-card ${isRegistered ? 'registered' : ''}`;

                subjectCard.innerHTML = `
                    <div class="status-badge ${isRegistered ? 'status-registered' : 'status-available'}">
                        ${isRegistered ? '履修中' : '履修可能'}
                    </div>
                    <div class="subject-title">${subject.name}</div>
                    <div class="subject-info">
                        <span class="info-tag">${subject.credits}単位</span>
                        <span class="info-tag ${subject.type === '必修' ? 'required' : 'elective'}">
                            ${subject.type}
                        </span>
                        <span class="info-tag">${subject.grade}年生対象</span>
                    </div>
                    ${subject.condition !== 'なし' ? `
                        <div class="subject-condition">
                            履修条件: ${subject.condition}
                        </div>
                    ` : ''}
                    <div class="action-buttons">
                        ${isRegistered ? `
                            <button class="btn btn-danger" onclick="Registration.unregister('${subject.id}')">
                                履修取消
                            </button>
                        ` : `
                            <button class="btn btn-primary" onclick="Registration.register('${subject.id}')">
                                履修登録
                            </button>
                        `}
                    </div>
                `;

                container.appendChild(subjectCard);
            });
        },

        // 履修中科目の表示
        displayRegistered: function() {
            const container = document.getElementById('registered-subjects');
            container.innerHTML = '';

            if (registeredSubjects.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1/-1;">履修中の科目はありません</p>';
                return;
            }

            registeredSubjects.forEach(subject => {
                const subjectCard = document.createElement('div');
                subjectCard.className = 'subject-card registered';

                subjectCard.innerHTML = `
                    <div class="status-badge status-registered">履修中</div>
                    <div class="subject-title">${subject.name}</div>
                    <div class="subject-info">
                        <span class="info-tag">${subject.credits}単位</span>
                        <span class="info-tag ${subject.type === '必修' ? 'required' : 'elective'}">
                            ${subject.type}
                        </span>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-danger" onclick="Registration.unregister('${subject.id}')">
                            履修取消
                        </button>
                    </div>
                `;

                container.appendChild(subjectCard);
            });
        }
    };
</script>